services:
    kopaygorodsky_notification.listener:
        class: Kopay\NotificationBundle\EventListener\NotificationListener
        arguments:
             - '@doctrine.orm.entity_manager'
             - '@event_dispatcher'
             - '@kopaygorodsky_notification.job_provider'
             - '@validator'
        tags:
            - { name: kernel.event_listener, event: kopaygorodsky.notification.message.created, method: onNotificationCreated }

    kopaygorodsky_notification.sending_provider.email:
        class: Kopay\NotificationBundle\Provider\EmailNotificationProvider
        arguments: ['@mailer', '@kopaygorodsky_notification.receiver_identity.email']
        tags:
            - {name: kopaygorodsky_notifications.sending_provider, type: email}

    kopaygorodsky_notification.sending_provider.push:
        class: Kopay\NotificationBundle\Provider\PushNotificationProvider
        arguments: ['@kopaygorodsky_notification.receiver_identity.id']
        tags:
            - {name: kopaygorodsky_notifications.sending_provider, type: push}

    kopaygorodsky_notification.receiver_identity.email:
        class: Kopay\NotificationBundle\Provider\ReceiverIdentity\EmailReceiverIdentity

    kopaygorodsky_notification.receiver_identity.id:
        class: Kopay\NotificationBundle\Provider\ReceiverIdentity\IdReceiverIdentity

    kopaygorodsky_notification.job_provider:
        class: Kopay\NotificationBundle\Job\JmsJobBundleProvider
        arguments: ['@doctrine.orm.entity_manager']

    kopaygorodsky_notification.console.send_notification:
        class: Kopay\NotificationBundle\Console\SendNotificationCommand
        arguments: ['@doctrine.orm.entity_manager','@event_dispatcher']
        ## sending providers added in compiler pass
        tags:
            - { name: console.command }

    kopaygorodsky_notification.metadata_listener:
        class: Kopay\NotificationBundle\EventListener\NotificationMetadataListener
        tags:
            - { name: doctrine.event_listener, event: loadClassMetadata }

    kopaygorodsky_notification.notification_server:
        class: Kopay\NotificationBundle\Server\NotificationServer
        #auth service will be injected in DP extension


    kopaygorodsky_notification.server_stack:
        lazy: true
        class: Kopay\NotificationBundle\Server\RatchetStack
        arguments: ['@kopaygorodsky_notification.notification_server']

    kopaygorodsky_notification.console.start_server:
        class: Kopay\NotificationBundle\Console\StartWebSocketsServer
        tags:
            - { name: console.command }

    kopaygorodsky_notification.websockets.auth_provider:
        class: Kopay\NotificationBundle\Server\Security\JwtAuthProvider
        arguments: ['@lexik_jwt_authentication.security.authentication.provider']